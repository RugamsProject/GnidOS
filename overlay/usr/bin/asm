#!/bin/sh

if [ $# -eq 0 ]; then
    echo "Usage: asm <file.asm> [output]"
    exit 1
fi

input_file="$1"
if [ $# -ge 2 ]; then
    output_file="$2"
else
    output_file="${input_file%.*}"
fi

# Проверяем расширение файла
if [ "${input_file##*.}" != "asm" ]; then
    echo "Error: File must have .asm extension"
    exit 1
fi

# Компилируем ассемблерный код
if ! nasm -f elf64 "$input_file" -o "/tmp/${output_file}.o"; then
    echo "Assembly failed"
    exit 1
fi

# Линкуем объектный файл
if ! ld -s -o "$output_file" "/tmp/${output_file}.o"; then
    echo "Linking failed"
    exit 1
fi

echo "Created executable: $output_file"

